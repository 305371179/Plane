var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(i,r){function s(t){try{h(o.next(t))}catch(e){r(e)}}function a(t){try{h(o["throw"](t))}catch(e){r(e)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}h((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return o([t,e])}}function o(n){if(i)throw new TypeError("Generator is already executing.");for(;h;)try{if(i=1,r&&(s=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(r,n[1])).done)return s;switch(r=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,r=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){h=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){h.label=n[1];break}if(6===n[0]&&h.label<s[1]){h.label=s[1],s=n;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(n);break}s[2]&&h.ops.pop(),h.trys.pop();continue}n=e.call(t,h)}catch(o){n=[6,o],r=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,r,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},BaseObject=function(t){function e(e){var n=t.call(this)||this;return n.bitmap=n.createBitmapByName(e),n.addChild(n.bitmap),n.setCenter(),n}return __extends(e,t),e.prototype.setCenter=function(){this.anchorOffsetX=this.bitmap.width/2,this.anchorOffsetY=this.bitmap.height/2},e.prototype.setScale=function(t){this.scaleX=t,this.scaleY=t},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);if(!n)throw t+"图片不存在";return e.texture=n,e},e}(egret.Sprite);__reflect(BaseObject.prototype,"BaseObject");var BasePlane=function(t){function e(e){var n=t.call(this,e)||this;return n.score=0,n.hp=1e4,n.atk=10,n.flySpeed=300,n.isExplode=!1,n.isDie=!1,n.bulletPositions=[],n.bulletSpeed=.05,n.shootInterval=200,n.threshold=0,n.hitCheckRadius=50,n.init(),n}return __extends(e,t),e.prototype.init=function(){},e.prototype.addShootTime=function(t){return this.threshold+=t,this.threshold>this.shootInterval?(this.threshold=0,!0):!1},e.prototype.hitCheck=function(t,e){return void 0===e&&(e=50),this._hitCheck(t,e)},e.prototype._hitCheck=function(t,e){if(void 0===e&&(e=50),this.isExplode||t.isExplode)return!1;var n=this.x,o=this.y,i=t.x,r=t.y;return Math.pow(n-i,2)+Math.pow(o-r,2)>Math.pow(e,2)?!1:!0},e.prototype.reduceHP=function(t){this.hp-=t.atk,this.hp<=0&&this.explode()},e.prototype.appear=function(t,e){this.x=t,this.y=e},e.prototype.shoot=function(t,e){},e.prototype.hurt=function(t){this.playHurtParticle(t)},e.prototype.playHurtParticle=function(t,e){var n=this;void 0===t&&(t=null),void 0===e&&(e=null);var o="boom_hurt_json";t||(o="boom_explode_json");var i=new BaseParticle("boom_yellow_png",o);if(t){var r=t.x,s=t.y;t instanceof BaseEnemy&&(r=this.x+t.x>>1,s=this.y+t.y>>1);var a=this.globalToLocal(r,s);i.x=a.x,i.y=a.y}else i.x=this.anchorOffsetX,i.y=this.anchorOffsetY;i.start(500),this.addChild(i),egret.setTimeout(function(){n.removeChild(i),t||(n.isDie=!0,e&&e())},this,1e3)},e.prototype.impact=function(){},e.prototype.explode=function(){},e.prototype.getXY=function(){return new egret.Point(this.anchorOffsetX*this.scaleX,this.anchorOffsetY*this.scaleY)},e.prototype.validate=function(){var t=this.getXY(),e=t.x,n=t.y;return!(this.x<-e||this.x>Global.stage.stageWidth+n||this.y<-n||this.y>Global.stage.stageHeight+n)},e.prototype.destroy=function(){this.parent&&(this.isDie=!0,this.parent.removeChild(this))},e.prototype.move=function(t){this.y+=this.flySpeed*t},e}(BaseObject);__reflect(BasePlane.prototype,"BasePlane");var BaseEnemy=function(t){function e(e){var n=t.call(this,e)||this;return n.expoldeAtk=20,n.bulletType=AlphaBullet,n}return __extends(e,t),e.prototype.init=function(){this.setScale(.5),this.appear(100,100),this.flySpeed=.1+.1*Math.random(),this.bulletSpeed=this.flySpeed+.3*Math.random()+.1,this.shootInterval=500*Math.random()+800,this.score=1,this.hp=60,this.bulletPositions=[{x:-20,y:20},{x:20,y:20}]},e.prototype.move=function(t){this.y+=this.flySpeed*t},e.prototype.shoot=function(t,e){var n=this;this.addShootTime(e)&&this.bulletPositions.forEach(function(e){var o=n.bulletType,i=new o(n);i.show(e),t.addBullet(i)})},e.prototype.hurt=function(t){return this.isExplode?void 0:(this.playHurtParticle(t),this.hp-=t.atk,this.hp<=0&&this.explode(),this.hp)},e.prototype.explode=function(){this.isExplode=!0,this.bitmap.visible=!1,this.playHurtParticle()},e}(BasePlane);__reflect(BaseEnemy.prototype,"BaseEnemy");var BaseBullet=function(t){function e(e,n){var o=t.call(this,n)||this;return o.owner=e,o.setScale(.2),o.bulletSpeed=e.bulletSpeed,o}return __extends(e,t),e.prototype.show=function(t){this.x=this.owner.x+t.x,this.y=this.owner.y+t.y},e.prototype.move=function(t){this.y+=this.bulletSpeed*t},e}(BasePlane);__reflect(BaseBullet.prototype,"BaseBullet");var AlphaEnemy=function(t){function e(e){void 0===e&&(e="alpha_png");var n=t.call(this,e)||this;return n.expoldeAtk=20,n.bulletType=AlphaBullet,n}return __extends(e,t),e}(BaseEnemy);__reflect(AlphaEnemy.prototype,"AlphaEnemy");var BossBullet=function(t){function e(e,n){void 0===n&&(n="bullet_shell_png");var o=t.call(this,e,n)||this;return o.owner=e,o.setScale(.2),o.bulletSpeed=e.bulletSpeed,o.atk=30,o}return __extends(e,t),e.prototype.show=function(t){this.x=this.owner.x+t.x,this.y=this.owner.y+t.y},e.prototype.move=function(t){this.y+=this.bulletSpeed*t},e}(BaseBullet);__reflect(BossBullet.prototype,"BossBullet");var BossEnemy=function(t){function e(e){void 0===e&&(e="boss_0_png");var n=t.call(this,e)||this;return n.expoldeAtk=20,n.factor=0,n.direction=1,n.hp=2e3,n.score=1e3,n.factor=Math.atan(Math.random()*Math.PI/4)*(Math.random()<.5?1:-1),n.bulletSpeed=.4,n.bulletType=BossBullet,n.hitCheckRadius=100,n.changeSpeed(),n.setScale(.6),n.bulletPositions=[{type:BossBullet,shootInterval:1500+1e3*Math.random(),positions:[{x:-32,y:0},{x:32,y:0}]},{type:BossDartBullet,shootInterval:2500+1e3*Math.random(),positions:[{x:-100,y:10},{x:100,y:10}]}],n}return __extends(e,t),e.prototype.changeSpeed=function(){this.flySpeed=.05+.05*Math.random()},e.prototype.move=function(t){this.flySpeed=.05+.1*Math.random();var e=this.flySpeed*t;this.y+=e*this.direction,this.x+=e*this.factor;var n=this.getXY(),o=n.x,i=n.y,r=Math.atan(Math.random()*Math.PI/4);this.x>Global.stage.stageWidth-o?(this.factor=-r,this.changeSpeed()):this.x<o&&(this.factor=r,this.changeSpeed()),this.y>1*Global.stage.stageHeight/3?(this.direction=-1,this.factor=r*(this.factor<0?-1:1),this.changeSpeed()):this.y<i&&(this.direction=1,this.factor=r*(this.factor<0?-1:1),this.changeSpeed())},e.prototype.shoot=function(t,e){var n=this;this.bulletPositions.forEach(function(o){var i=o.positions,r=o.type,s=o.shootInterval;o.time=o.time?o.time+e:e,o.time>=s&&(o.time=0,i.forEach(function(e){var o=new r(n);o.show(e),t.addBullet(o)}))})},e.prototype.hitCheck=function(t,e){return void 0===e&&(e=50),!1},e}(AlphaEnemy);__reflect(BossEnemy.prototype,"BossEnemy");var BaseItem=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.init=function(){this.flySpeed=.2,this.setScale(.2),this.factor=Math.atan(Math.random()*Math.PI/4)*(Math.random()<.5?1:-1)},e.prototype.react=function(t){},e.prototype.move=function(t){var e=this.flySpeed*t;this.y+=e,this.x+=e*this.factor;var n=this.getXY(),o=n.x;n.y;(this.x<o||this.x>Global.stage.stageWidth-o)&&(this.factor*=-1)},e}(BasePlane);__reflect(BaseItem.prototype,"BaseItem");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function o(o){e.call(n,o,t)}if(RES.hasRes(t)){var i=RES.getRes(t);i?o(i):RES.getResAsync(t,o,this)}else RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var BetaBullet=function(t){function e(e,n){void 0===n&&(n="bullet_comet_png");var o=t.call(this,e,n)||this;return o.owner=e,o.setScale(.2),o.bulletSpeed=e.bulletSpeed,o}return __extends(e,t),e}(BaseBullet);__reflect(BetaBullet.prototype,"BetaBullet");var BossDartBullet=function(t){function e(e,n){void 0===n&&(n="bullet_dart_png");var o=t.call(this,e,n)||this;return o.factor=0,o.owner=e,o.setScale(.2),o.bulletSpeed=e.bulletSpeed,o.atk=40,o.factor=Math.atan(Math.random()*Math.PI/8)*(Math.random()<.5?1:-1),o}return __extends(e,t),e.prototype.move=function(t){var e=this.bulletSpeed*t;this.y+=e,this.x+=e*this.factor,this.rotation+=5},e}(BaseBullet);__reflect(BossDartBullet.prototype,"BossDartBullet");var BossNavBullet=function(t){function e(e,n){void 0===n&&(n="bullet_navigate_png");var o=t.call(this,e,n)||this;return o.atk=60,o.rotation=180,o}return __extends(e,t),e.prototype.trace=function(t,e){var n=this.bulletSpeed*t,o=Math.PI/2;void 0!==this.angle?o=this.angle:(e.x-this.x!==0&&(o=Math.atan((e.y-this.y)/(e.x-this.x))),e.x-this.x<0&&(o+=Math.PI),this.angle=o);var i=180*o/Math.PI;this.y+=n*Math.sin(o),this.x+=n*Math.cos(o),this.rotation=90+i},e}(BossBullet);__reflect(BossNavBullet.prototype,"BossNavBullet");var Global=function(){function t(){}return t.addScene=function(t){this.stage.addChild(t)},t.replaceScene=function(t){this.stage.removeChildren(),this.stage.addChild(t)},t.pause=function(){var t=this.stage.getChildAt(this.stage.numChildren-1);t&&t instanceof GameScene&&egret.Tween.pauseTweens(t.heroPlane)},t.resume=function(){var t=this;egret.setTimeout(function(){var e=t.stage.getChildAt(t.stage.numChildren-1);e&&e instanceof GameScene&&egret.Tween.resumeTweens(e.heroPlane)},this,0)},t.getRandomElement=function(t){return t[Math.floor(t.length*Math.random())]},t}();__reflect(Global.prototype,"Global");var BulletContainer=function(t){function e(){var e=t.call(this)||this;return e.bullets=[],e}return __extends(e,t),e.prototype.addBullet=function(t){this.bullets.push(t),this.addChild(t)},e.prototype.move=function(t,e,n){for(var o=this.bullets.length-1;o>=0;o--){var i=this.bullets[o];if(i instanceof BossNavBullet?i.trace(n,t):i.move(n),i.isDie)this.destroy(o);else{if(i.owner===t){var r=e.hitCheck(t,i);if(r){this.destroy(o);continue}}else if(i.hitCheck(t)){t.hurt(i),this.destroy(o);continue}i.validate()||this.destroy(o)}}},e.prototype.destroy=function(t){this.removeChildAt(t),this.bullets.splice(t,1)},e}(egret.Sprite);__reflect(BulletContainer.prototype,"BulletContainer");var HeroBullet=function(t){function e(e,n){void 0===n&&(n="bullet_png");var o=t.call(this,e,n)||this;return o.owner=e,o.setScale(.2),o.atk=20,o.bulletSpeed=e.bulletSpeed,o}return __extends(e,t),e}(BaseBullet);__reflect(HeroBullet.prototype,"HeroBullet");var LaserBullet=function(t){function e(n,o){void 0===o&&(o="bullet_ball_png");var i=t.call(this,n,o)||this;if(i.duration=100,i.timer=0,i.bitmap.visible=!1,i.owner=n,i.atk=1,i.setScale(1.5),i.anchorOffsetX=0,i.anchorOffsetY=0,i.appear(i.owner.x,i.owner.y+i.anchorOffsetY*i.scaleY),e.initFirst){var r=RES.getRes("laser_ske_json"),s=RES.getRes("laser_tex_json"),a=RES.getRes("laser_tex_png");e.egretFactory=dragonBones.EgretFactory.factory,e.egretFactory.parseDragonBonesData(r),e.egretFactory.parseTextureAtlasData(s,a)}var h=e.egretFactory.buildArmatureDisplay("Sprite");return i.addChild(h),h.animation.play("Sprite",0),i}return __extends(e,t),e.prototype.hitCheck=function(t,e){return void 0===e&&(e=50),Math.abs(this.x-t.x)<e&&t.hurt(this),!1},e.prototype.validate=function(){return!0},e.prototype.move=function(t){this.isDie||(this.timer+=t,this.timer>this.duration&&(this.isDie=!0),this.appear(this.owner.x,this.owner.y+this.anchorOffsetY*this.scaleY))},e.initFirst=!0,e}(BaseBullet);__reflect(LaserBullet.prototype,"LaserBullet");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){Global.stage=this.stage,egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause(),Global.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume(),Global.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return n.sent(),this.stage.removeChild(t),[3,5];case 4:return e=n.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,n){var o=new eui.Theme("resource/default.thm.json",t.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){Global.addScene(new GameScene)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var BetaEnemy=function(t){function e(e){void 0===e&&(e="beta_png");var n=t.call(this,e)||this;return n.expoldeAtk=20,n.factor=0,n.hp=80,n.score=2,n.factor=Math.atan(Math.random()*Math.PI/4)*(Math.random()<.5?1:-1),n.bulletSpeed=.4,n.bulletType=BetaBullet,n.setScale(.6),n.bulletPositions=[{x:-25,y:0},{x:25,y:0}],n}return __extends(e,t),e.prototype.move=function(t){var e=this.flySpeed*t;this.y+=e,this.x+=e*this.factor,(this.x<50||this.x>Global.stage.stageWidth-50)&&(this.factor*=-1)},e}(AlphaEnemy);__reflect(BetaEnemy.prototype,"BetaEnemy");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var BossEnemy1=function(t){function e(e){void 0===e&&(e="boss_1_png");var n=t.call(this,e)||this;return n.expoldeAtk=20,n.factor=0,n.direction=1,n.bulletPositions=[{type:BossBullet,shootInterval:1500+1e3*Math.random(),positions:[{x:-32,y:0},{x:32,y:0}]},{type:BossDartBullet,shootInterval:2500+1e3*Math.random(),positions:[{x:-100,y:10},{x:100,y:10}]},{type:BossNavBullet,shootInterval:3500+1e3*Math.random(),positions:[{x:-60,y:0},{x:60,y:0}]}],n}return __extends(e,t),e}(BossEnemy);__reflect(BossEnemy1.prototype,"BossEnemy1");var BossEnemy2=function(t){function e(e){void 0===e&&(e="boss_2_png");var n=t.call(this,e)||this;return n.expoldeAtk=20,n.factor=0,n.direction=1,n.laserDuration=2e3,n.laserInterval=1e3,n.laserTime=0,n.bulletPositions=[{type:BossBullet,shootInterval:1500+1e3*Math.random(),positions:[{x:-32,y:0},{x:32,y:0}]},{type:BossDartBullet,shootInterval:2500+1e3*Math.random(),positions:[{x:-100,y:10},{x:100,y:10}]},{type:BossNavBullet,shootInterval:3500+1e3*Math.random(),positions:[{x:-60,y:0},{x:60,y:0}]}],n}return __extends(e,t),e.prototype.shoot=function(e,n){t.prototype.shoot.call(this,e,n),this.laserTime+=n,!this.laserBullet&&this.laserTime>this.laserInterval?(this.laserBullet=new LaserBullet(this),this.laserBullet.duration=this.laserDuration,e.addBullet(this.laserBullet),this.laserTime=0):this.laserBullet&&this.laserBullet.isDie&&(this.laserTime=0,this.laserBullet=null,this.laserDuration=2e3+4e3*Math.random(),this.laserInterval=4e3+2e3*Math.random())},e}(BossEnemy);__reflect(BossEnemy2.prototype,"BossEnemy2");var EnemyContainer=function(t){function e(){var e=t.call(this)||this;return e.threshold=1500,e.createTime=0,e.enemies=[],e.enemyTypes=[AlphaEnemy,BetaEnemy,GammaEnemy],e.stepTime=0,e.currentIndex=0,e.stageSetting=[{boss:BossEnemy,time:2e4},{boss:BossEnemy1,time:3e4},{boss:BossEnemy2,time:5e4}],e}return __extends(e,t),e.prototype.addthreathod=function(t){return this.stepTime+=t,this.createTime+=t,this.createTime>this.threshold?(this.createTime=0,this.threshold=1e3+500*Math.random(),!0):!1},e.prototype.appear=function(t){var e=t.getXY(),n=e.x,o=e.y;t.appear(n+Math.random()*(Global.stage.stageWidth-2*n),-o)},e.prototype.createEnemy=function(t){if(this.addthreathod(t)){var e,n=this.stageSetting[this.currentIndex%this.stageSetting.length];if(!this.currentBoss&&this.stepTime>n.time)e=new n.boss,this.currentBoss=e,this.currentIndex++;else{var o=Global.getRandomElement(this.enemyTypes);e=new o}this.currentBoss&&this.currentBoss.isDie&&(this.currentBoss=null,this.stepTime=0),this.appear(e),this.addEnemy(e)}},e.prototype.moveAndShoot=function(t,e,n){for(var o=this.enemies.length-1;o>=0;o--){var i=this.enemies[o];i.move(n),i.isDie?this.destroy(o):i.isExplode||(i.shoot(e,n),i.hitCheck(t,80)?(i.explode(),t.hurt(i)):i.validate()||this.destroy(o))}},e.prototype.hitCheck=function(t,e){for(var n=this.enemies.length-1;n>=0;n--){var o=this.enemies[n];if(!(o.y<0||o.isExplode)&&e.hitCheck(o,o.hitCheckRadius)){var i=o.hurt(e);return 0===i&&t.dispatchScoreEvent(o.score),o}}return null},e.prototype.addEnemy=function(t){this.enemies.push(t),this.addChild(t)},e.prototype.destroy=function(t){this.removeChildAt(t),this.enemies.splice(t,1)},e}(egret.Sprite);__reflect(EnemyContainer.prototype,"EnemyContainer");var GammaEnemy=function(t){function e(e){void 0===e&&(e="gamma_png");var n=t.call(this,e)||this;return n.expoldeAtk=20,n.setScale(.3),n.flySpeed=.2+.5*Math.random(),n.hp=100,n.score=3,n}return __extends(e,t),e.prototype.shoot=function(){},e}(BaseEnemy);__reflect(GammaEnemy.prototype,"GammaEnemy");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,o){function i(t){e.call(o,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),n.call(o))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(o,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,n){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(o,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var a=t.split("/");a.pop();var h=a.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(o,generateJSON.paths[t])},this):RES.getResByUrl(h,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){e.call(o,generateJSON.paths[t])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(o,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var BloodItem=function(t){function e(){var e=t.call(this,"blood_png")||this;return e.blood=10,e}return __extends(e,t),e.prototype.react=function(t){t.addBlood(this.blood)},e}(BaseItem);__reflect(BloodItem.prototype,"BloodItem");var ItemContainer=function(t){function e(){var e=t.call(this)||this;return e.threshold=500,e.createTime=0,e.items=[],e}return __extends(e,t),e.prototype.addthreathod=function(t){return this.createTime+=t,this.createTime>this.threshold?(this.createTime=0,this.threshold=1e3*Math.random()+500,!0):!1},e.prototype.appear=function(t){var e=t.getXY(),n=e.x,o=e.y;t.appear(n+Math.random()*(Global.stage.stageWidth-n),-o)},e.prototype.createItem=function(t){if(this.addthreathod(t)){var e=new BloodItem;this.appear(e),this.addItem(e)}},e.prototype.move=function(t,e){for(var n=this.items.length-1;n>=0;n--){var o=this.items[n];o.move(e),o.hitCheck(t,50)?(o.react(t),this.destroy(n)):o.validate()||this.destroy(n)}},e.prototype.addItem=function(t){this.items.push(t),this.addChild(t)},e.prototype.destroy=function(t){this.removeChildAt(t),this.items.splice(t,1)},e}(egret.Sprite);__reflect(ItemContainer.prototype,"ItemContainer");var BaseParticle=function(t){function e(e,n){void 0===e&&(e="boom_white_png"),void 0===n&&(n="boom_white_json");var o=this,i=RES.getRes(e),r=RES.getRes(n);return o=t.call(this,i,r)||this}return __extends(e,t),e}(particle.GravityParticleSystem);__reflect(BaseParticle.prototype,"BaseParticle");var AlphaBullet=function(t){function e(e,n){void 0===n&&(n="bullet_ball_png");var o=t.call(this,e,n)||this;return o.owner=e,o.setScale(.2),o.bulletSpeed=e.bulletSpeed,o}return __extends(e,t),e}(BaseBullet);__reflect(AlphaBullet.prototype,"AlphaBullet");var HeroPlane=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.init=function(){this.setScale(.5),this.flySpeed=300,this.hp=100,this.bulletSpeed=-.6,this.bulletPositions=[{x:-20,y:20},{x:20,y:20}],Global.plane=this},e.prototype.fly=function(t,e){var n=Math.sqrt(Math.pow(t-this.x,2)+Math.pow(e-this.y,2))/this.flySpeed;egret.Tween.removeTweens(this);var o=egret.Tween.get(this,{});o.to({x:t,y:e},1e3*n,egret.Ease.sineOut)},e.prototype.addBlood=function(t){void 0===t&&(t=0),this.dispatchHPEvent(-t)},e.prototype.dispatchHPEvent=function(t){if(void 0===t&&(t=0),0!==this.hp){this.hp-=t,this.hp<=0&&(this.hp=0,this.explode());var e=new egret.Event("setHP");e.data=this.hp,this.dispatchEvent(e)}},e.prototype.dispatchScoreEvent=function(t){void 0===t&&(t=0),this.score+=t;var e=new egret.Event("setScore");e.data=this.score+"",this.dispatchEvent(e)},e.prototype.shoot=function(t,e){var n=this;this.isExplode||this.addShootTime(e)&&this.bulletPositions.forEach(function(e){var o=new HeroBullet(n);o.show(e),t.addBullet(o)})},e.prototype.hurt=function(t){t instanceof BaseEnemy?this.dispatchHPEvent(t.expoldeAtk):this.dispatchHPEvent(t.atk),this.playHurtParticle(t)},e.prototype.explode=function(){var t=this;this.playHurtParticle(null,function(){var e=new egret.Event("gameOver");t.dispatchEvent(e)})},e}(BasePlane);__reflect(HeroPlane.prototype,"HeroPlane");var GameOverScene=function(t){function e(e){void 0===e&&(e="0");var n=t.call(this)||this;return n.scoreNumber=e,n}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.animation.play(),this.score.text=this.scoreNumber;var e=egret.localStorage.getItem("score")||0;parseInt(this.scoreNumber)>e&&(e=this.scoreNumber,egret.localStorage.setItem("score",this.scoreNumber)),this.historyScore.text=e+"",console.log(e),this.button.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Global.addScene(new GameScene)},this)},e}(eui.Component);__reflect(GameOverScene.prototype,"GameOverScene",["eui.UIComponent","egret.DisplayObject"]);var GameScene=function(t){function e(){var e=t.call(this)||this;return e.timeInterval=1/60*1e3,e.bgSpeed=.3,e.timeOnEnterFrame=0,e.lockTime=100,Sound.play(),e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init(),this.setListeners()},e.prototype.init=function(){this.bulletContainer=new BulletContainer,this.enemyContainer=new EnemyContainer,this.itemContainer=new ItemContainer,this.heroPlane=new HeroPlane("hero_png"),this.heroPlane.appear(Global.stage.stageWidth/2,2*Global.stage.stageHeight/3),this.addChild(this.bulletContainer),this.addChild(this.heroPlane),this.addChild(this.enemyContainer),this.addChild(this.itemContainer),this.setChildIndex(this.group,this.numChildren-1)},e.prototype.setListeners=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchStart,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.heroPlane.addEventListener("setHP",this.setHP,this),this.heroPlane.addEventListener("setScore",this.setScore,this),this.heroPlane.addEventListener("gameOver",this.gameOver,this),this.heroPlane.dispatchHPEvent(),this.heroPlane.dispatchScoreEvent()},e.prototype.setHP=function(t){this.hp.text=t.data+""},e.prototype.setScore=function(t){this.score.text=t.data},e.prototype.removeListener=function(){this.touchEnabled=!1,this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchStart,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.heroPlane.removeEventListener("setHP",this.setHP,this),this.heroPlane.removeEventListener("setScore",this.setScore,this)},e.prototype.touchStart=function(t){this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.heroPlane.fly(t.stageX,t.stageY)},e.prototype.setLockTimeout=function(){return this.lockTouchMove?!0:(this.lockTouchMove=!0,egret.clearTimeout(this.timeoutId),this.timeoutId=egret.setTimeout(function(){this.lockTouchMove=!1},this,this.lockTime),!1)},e.prototype.touchMove=function(t){this.setLockTimeout()||this.heroPlane.fly(t.stageX,t.stageY)},e.prototype.touchEnd=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this)},e.prototype.onEnterFrame=function(){var t=egret.getTimer(),e=this.timeOnEnterFrame,n=t-e;this.timeOnEnterFrame=t,n>2*this.timeInterval||(this.scrollBg(n),this.heroPlane.shoot(this.bulletContainer,n),this.bulletContainer.move(this.heroPlane,this.enemyContainer,n),this.enemyContainer.createEnemy(n),this.enemyContainer.moveAndShoot(this.heroPlane,this.bulletContainer,n),this.itemContainer.createItem(n),this.itemContainer.move(this.heroPlane,n))},e.prototype.scrollBg=function(t){var e=this.bgSpeed*t;this.bg1.y+=e,this.bg2.y+=e,this.bg1.y>Global.stage.stageHeight&&(this.bg1.y=this.bg2.y,this.bg2.y-=this.bg2.height)},e.prototype.gameOver=function(){this.removeListener(),egret.Tween.removeTweens(this.heroPlane),Sound.close(),Global.addScene(new GameOverScene(this.score.text))},e}(eui.Component);__reflect(GameScene.prototype,"GameScene",["eui.UIComponent","egret.DisplayObject"]);var MenuScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.animation.play(),this.button.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Global.replaceScene(new GameScene)},this)},e}(eui.Component);__reflect(MenuScene.prototype,"MenuScene",["eui.UIComponent","egret.DisplayObject"]);var Sound=function(){function t(){}return t.play=function(){this.sound||(this.sound=RES.getRes("StarWar_mp3")),this.channel=this.sound.play()},t.close=function(){this.channel.stop()},t}();__reflect(Sound.prototype,"Sound");